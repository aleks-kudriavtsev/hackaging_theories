api_keys:
  openalex:
    env: OPENALEX_API_KEY
  crossref_contact:
    env: CROSSREF_API_KEY
    default: "you@example.com"
  pubmed:
    env: PUBMED_API_KEY
  serpapi:
    env: SERPAPI_KEY
  semantic_scholar:
    env: SEMANTIC_SCHOLAR_KEY
  openai:
    env: OPENAI_API_KEY
  scihub_email:
    env: SCIHUB_EMAIL
  scihub_rapidapi:
    env: SCIHUB_RAPIDAPI_KEY
  annas_archive:
    env: ANNAS_ARCHIVE_API_KEY

data_sources:
  seed_papers: data/examples/seed_papers.json

providers:
  - name: openalex
    type: openalex
    enabled: true
    api_key_key: openalex
    batch_size: 200
    rate_limit_per_sec: 5
    query_shards:
      - "{query}"
      - "{query} aging"
  - name: crossref
    type: crossref
    enabled: false  # Crossref remains optional; PubMed powers quickstart by default
    api_key_key: crossref_contact
    batch_size: 100
    rate_limit_per_sec: 10
    query_shards:
      - "{query}"
  - name: serpapi_scholar
    type: serpapi_scholar
    enabled: false
    api_key_key: serpapi
    base_url: https://serpapi.com/search.json
    batch_size: 10
    rate_limit_per_sec: 0.5
    extra:
      engine: google_scholar
      max_page_size: 10
  - name: semantic_scholar
    type: semantic_scholar
    enabled: false
    api_key_key: semantic_scholar
    base_url: https://api.semanticscholar.org/graph/v1/paper/search
    batch_size: 100
    rate_limit_per_sec: 4
    extra:
      fields:
        - title
        - abstract
        - authors
        - year
        - externalIds
        - openAccessPdf
        - url
        - citationCount
        - influentialCitationIds
  - name: pubmed
    type: pubmed
    enabled: true
    api_key_key: pubmed
    batch_size: 200
    rate_limit_per_sec: 3
  - name: scihub
    type: scihub
    enabled: false
    api_key_key: scihub_rapidapi
    base_url: https://sci-hub2.p.rapidapi.com/search
    batch_size: 20
    rate_limit_per_sec: 1
    extra:
      mode: rapidapi
      rapidapi_host: sci-hub2.p.rapidapi.com
      email_key: scihub_email
      params:
        type: doi
      fulltext_keys:
        - fullTextUrl
        - url
        - pdfUrl
  - name: annas_archive
    type: annas_archive
    enabled: false
    api_key_key: annas_archive
    base_url: https://annas-archive-api.p.rapidapi.com/search
    batch_size: 25
    rate_limit_per_sec: 1
    extra:
      rapidapi_host: annas-archive-api.p.rapidapi.com
      link_keys:
        - mirrors
        - files
      params:
        category: scimag
  - name: biorxiv
    type: biorxiv
    enabled: false  # Enable once you have confirmed <=1 req/sec with your deployment
    base_url: https://api.biorxiv.org/details/biorxiv
    batch_size: 100
    rate_limit_per_sec: 1
    date_window:
      from: 2023-01-01
      to: 2023-01-15
    categories:
      - neuroscience
  - name: medrxiv
    type: medrxiv
    enabled: false
    base_url: https://api.biorxiv.org/details/medrxiv
    batch_size: 100
    rate_limit_per_sec: 1
    date_window:
      from: 2023-01-01
      to: 2023-01-15
    categories:
      - geriatrics

classification:
  llm:
    model: null  # Override via CLI or set a model name when ready
    api_key_key: openai
    batch_size: 4
    cache_dir: data/cache/llm
    max_retries: 3
    retry_backoff: 2.0
    request_timeout: 60
  keywords:
    Activity Theory:
      - activity
      - engagement
      - participation
    Socioemotional Selectivity Theory:
      - socioemotional
      - goal
      - emotional
    Disengagement Theory:
      - disengagement
      - withdrawal
      - detach

corpus:
  cache_dir: data/cache/literature
  min_citation_count: 5
  prefer_reviews: true
  sort_by_citations: true
  global_limit: 1500
  expansion:
    enabled: false  # Set to true to allow adaptive query exploration
    max_new_queries: 4
    max_snippets: 10
    max_gpt_queries: 3
    embedding_neighbors: 4
    gpt_prompt: |
      You are helping expand literature search queries for the Hackaging project.
      Return a JSON array of new search strings based on the supplied snippets.
      Avoid duplicates of the existing queries and keep each query under 12 words.
  targets:
    Activity Theory:
      target: 600
      queries:
        - "{base_query} activity theory"
        - "activity theory older adults"
      expansion:
        enabled: true
        max_new_queries: 3
        max_snippets: 8
      subtheories:
        Engagement:
          target: 300
          queries:
            - "activity theory engagement older adults"
        Participation:
          target: 200
          queries:
            - "activity theory participation aging"
    Socioemotional Selectivity Theory:
      target: 500
      queries:
        - "{base_query} socioemotional selectivity theory"
        - "socioemotional selectivity older adults"
      expansion:
        enabled: true
        use_embeddings: true
        use_gpt: false
    Disengagement Theory:
      target: 400
      queries:
        - "{base_query} disengagement theory"
        - "aging disengagement theory"
      expansion:
        enabled: true
        gpt_prompt: |
          Generate at most 2 concise search strings as a JSON array.
          Focus on methodological keywords or populations that appear in the snippets.
        max_new_queries: 2

extraction:
  llm:
    enabled: true
    model: null  # Override via CLI to enable GPT-backed extraction
    temperature: 0.0
    batch_size: 4
    cache_dir: data/cache/llm_extraction
    max_retries: 3
    retry_backoff: 2.0
    request_timeout: 60
    max_sentences: 5
    decline_answers:
      - unknown
      - none
      - no_answer
    system_prompt: |
      You are assisting the Hackaging project by answering structured research questions.
      Select the best answer category using only the supplied evidence sentences.
      If the evidence is insufficient, respond with "unknown".
    request_template: |
      Question: {question}
      Allowed answers: {choices}
      Evidence sentences:
      {evidence}
      Respond with a JSON object containing keys "answer", "confidence", and "rationale".
  calibration:
    gpt_weight: 0.6
    override_threshold: 0.85
    agreement_boost: 0.1
    disagreement_penalty: 0.1
  questions:
    - id: Q1
      prompt: "Does the paper report a biomarker of aging?"
      allowed_answers:
        - yes_quantitative
        - yes_unverified
        - no
    - id: Q2
      prompt: "Does the paper describe a molecular mechanism for longevity?"
      allowed_answers:
        - mechanistic_evidence
        - mechanistic_hypothesis
        - no
    - id: Q3
      prompt: "Does the study test or propose a longevity intervention?"
      allowed_answers:
        - validated_intervention
        - proposed_intervention
        - no
    - id: Q4
      prompt: "Does the paper address irreversibility or reversibility of aging changes?"
      allowed_answers:
        - irreversible
        - reversible
        - not_discussed
    - id: Q5
      prompt: "Does the paper provide cross-species lifespan predictors?"
      allowed_answers:
        - yes_quantitative
        - yes_unverified
        - no
    - id: Q6
      prompt: "Does the paper focus on naked mole rat longevity?"
      allowed_answers:
        - primary_focus
        - mentioned
        - no
    - id: Q7
      prompt: "Does the paper focus on avian longevity?"
      allowed_answers:
        - primary_focus
        - mentioned
        - no
    - id: Q8
      prompt: "Does the paper link body size to longevity?"
      allowed_answers:
        - supported
        - speculative
        - no
    - id: Q9
      prompt: "Does the paper examine calorie restriction and lifespan?"
      allowed_answers:
        - experimental
        - observational
        - no

outputs:
  papers: data/examples/papers.csv
  theories: data/examples/theories.csv
  questions: data/examples/questions.csv
  cache_dir: data/cache

pipeline:
  max_results: 10
  parallel_fetch: 4
  classification_workers: 4
